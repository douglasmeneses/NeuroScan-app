generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Questionario {
  id                Int        @id @default(autoincrement())
  nome              String
  quantidade_questoes Int
  perguntas         Pergunta[]
  
  @@map("questionarios")
}

model Pergunta {
  id             Int           @id @default(autoincrement())
  numero         Int
  questionario_id Int
  texto          String
  questionario   Questionario  @relation(fields: [questionario_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  respostas      Resposta[]
  
  @@map("perguntas")
}

model Usuario {
  id                              Int        @id @default(autoincrement())
  iniciais_do_nome                String
  idade                           Int
  sexo                            String?    @db.Char(1)
  email                           String?
  renda_mensal                    Decimal?   @db.Decimal(10, 2)
  estado_civil                    String?
  ocupacao                        String?
  carga_horaria_semanal           Int?
  escolaridade                    String?
  estado                          String?    @db.Char(2)
  faz_tratamento_psicologico      Boolean?
  tratamentos                     String?    @db.Text
  toma_medicacao_psiquiatrica     Boolean?
  medicacoes                      String?    @db.Text
  created_at                      DateTime   @default(now()) @db.Timestamptz(6)
  updated_at                      DateTime   @default(now()) @updatedAt @db.Timestamptz(6)
  respostas                       Resposta[]
  gonogos                         GoNogo[]
  
  @@map("usuarios")
}

model Resposta {
  id                  Int       @id @default(autoincrement())
  pergunta_id         Int
  usuario_id          Int
  resposta            String
  duracao             Float       // em milissegundos
  idle                Float       // tempo at√© primeiro clique em milissegundos
  quantidade_cliques  Int
  quantidade_passos   Int
  dh_inicio           DateTime @db.Timestamptz(6)
  dh_fim              DateTime @db.Timestamptz(6)
  pergunta            Pergunta  @relation(fields: [pergunta_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  usuario             Usuario   @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  coletas             Coleta[]
  
  @@map("respostas")
}

model Coleta {
  id           Int            @id @default(autoincrement())
  resposta_id  Int
  timestamp    DateTime @db.Timestamptz(6)
  resposta     Resposta       @relation(fields: [resposta_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  acelerometro Acelerometro?
  giroscopio   Giroscopio?
  
  @@map("coletas")
}

model Acelerometro {
  id        Int    @id @default(autoincrement())
  coleta_id Int    @unique
  eixo_x    Float
  eixo_y    Float
  eixo_z    Float
  coleta    Coleta @relation(fields: [coleta_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  @@map("acelerometros")
}

model Giroscopio {
  id        Int    @id @default(autoincrement())
  coleta_id Int    @unique
  eixo_x    Float
  eixo_y    Float
  eixo_z    Float
  coleta    Coleta @relation(fields: [coleta_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  @@map("giroscopios")
}

model GoNogo {
  id                              Int       @id @default(autoincrement())
  usuario_id                      Int
  erros_comissao_percentual       Float
  erros_omissao_percentual        Float
  acerto_go_percentual            Float
  tempo_medio_reacao_ms           Float
  variabilidade_rt_ms             Float
  latencia_media_nogo_erro        Float
  created_at                      DateTime  @default(now()) @db.Timestamptz(6)
  updated_at                      DateTime  @default(now()) @updatedAt @db.Timestamptz(6)
  usuario                         Usuario   @relation(fields: [usuario_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
  
  @@map("gonogos")
}

